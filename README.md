# 我只汉化插件界面，具体更新内容（英文）见
https://github.com/airbnb/lottie-web/blob/master/CHANGELOG.md

-2018.11.26更新[5.4.2汉化](https://raw.githubusercontent.com/bigxixi/bodymovin_cn/master/5.4.2/bodymovin542cn.zxp)  
-2018.10.30更新[5.4.1汉化](https://raw.githubusercontent.com/bigxixi/bodymovin_cn/master/5.4.1/bodymovin541cn.zxp)  
-2018.10.11更新[5.3.4汉化](https://raw.githubusercontent.com/bigxixi/bodymovin_cn/master/5.3.4/bodymovin534cn.zxp)  
-2018.10.03更新[5.3.3汉化](https://raw.githubusercontent.com/bigxixi/bodymovin_cn/master/5.3.3/bodymovin533cn.zxp)  
-2018.09.25更新[5.3.1汉化](https://raw.githubusercontent.com/bigxixi/bodymovin_cn/master/5.3.1/bodymovin531cn.zxp)  
-2018.09.17更新[5.3.0汉化](https://raw.githubusercontent.com/bigxixi/bodymovin_cn/master/5.3.0/bodymovin530cn.zxp)  
-2018.08.10更新[5.2.1汉化](https://raw.githubusercontent.com/bigxixi/bodymovin_cn/master/5.2.1/bodymovin521cn.zxp)  
-2018.07.30更新[5.2.0汉化](https://raw.githubusercontent.com/bigxixi/bodymovin_cn/master/5.2.0/bodymovin520cn.zxp)  
-2018.07.06更新[5.1.20汉化](https://raw.githubusercontent.com/bigxixi/bodymovin_cn/master/5.1.20/bodymovin5120cn.zxp)   
-2018.05.28更新[5.1.16汉化](https://raw.githubusercontent.com/bigxixi/bodymovin_cn/master/5.1.16/bodymovin5116cn.zxp)   

 **从5.1.16开始，官方已修复导出png带黑边问题，不需修复，详见：https://zhuanlan.zhihu.com/p/37385550**  
 
-2018.04.23更新[5.1.12汉化](https://raw.githubusercontent.com/bigxixi/bodymovin_cn/master/5.1.12/bodymovin5112cn.zxp)     
-2018.04.08更新[5.1.10汉化](https://raw.githubusercontent.com/bigxixi/bodymovin_cn/master/5.1.10/bodymovin5.1.10cn.zxp)     
-2018.03.21更新[5.1.9汉化](https://github.com/bigxixi/bodymovin_cn/raw/master/5.1.9/%E4%B8%AD%E6%96%87%E4%BF%AE%E5%A4%8D%E7%89%88/bodymovin.zxp)        
-————————
# AE动画导出json工具-bodymovin(lottie)汉化版

1.汉化需要先解包原版，汉化后再打包为zxp，用的是自定义签名，如介意请使用英文原版。  
  细节参考：http://nullice.com/archives/1741   
2.修正了原版导出带透明通道png图片资源会有黑边问题。  



## 汉化截图
<img src="https://raw.githubusercontent.com/bigxixi/ReadMe-Resources/master/bodymovincn/bdmcn1.png" width="100%" />
<img src="https://raw.githubusercontent.com/bigxixi/ReadMe-Resources/master/bodymovincn/bdmcn2.png" width="100%" />
<img src="https://raw.githubusercontent.com/bigxixi/ReadMe-Resources/master/bodymovincn/bdmcn3.png" width="100%" />
<img src="https://raw.githubusercontent.com/bigxixi/ReadMe-Resources/master/bodymovincn/bdmcn4.png" width="100%" />
<img src="https://raw.githubusercontent.com/bigxixi/ReadMe-Resources/master/bodymovincn/bdmcn5.png" width="100%" />


## 下载地址  
[`汉化+png黑边修复版`](https://github.com/bigxixi/bodymovin_cn/blob/master/5.1.8/%E4%B8%AD%E6%96%87%E4%BF%AE%E5%A4%8D%E7%89%88/bodymovin5.1.8cnFixed.zxp)
</br>

***——其他版本：***  
</br>
[`英文原版（最新）`](https://github.com/airbnb/lottie-web/blob/master/build/extension/bodymovin.zxp)  
[`汉化版（仅汉化，未修复png黑边问题）`](https://github.com/bigxixi/bodymovin_cn/blob/master/5.1.8/%E4%B8%AD%E6%96%87%E5%8E%9F%E7%89%88/bodymovin5.1.8cn.zxp)  
[`英文版（仅修复png黑边问题）`](https://github.com/bigxixi/bodymovin_cn/blob/master/5.1.8/%E8%8B%B1%E6%96%87%E4%BF%AE%E5%A4%8D%E7%89%88/bodymovin5.1.8enFixed.zxp)  
## 安装方法
推荐使用 https://aescripts.com/learn/zxp-installer/ 的zxp安装器安装：  


[`Windows版下载`](https://updates.aescripts.com/zxp-installer/win/aescript%20+%20aeplugins%20zxp%20installer.exe)  
</br> 
快捷键`ctrl + o`，然后选择zxp文件进行安装。如果之前安装过bodymovin，会覆盖掉原来的版本。  

</br>  
<img src="https://aescripts.com/media/wysiwyg/aescripts/learn/ZXP_Installer_Windows_UI.png" width="50%"/>
</br>  
</br>  

[`Mac版下载`](https://updates.aescripts.com/zxp-installer/mac/aescripts%20+%20aeplugins%20-%20zxp%20installer.dmg)  
</br> 
直接将zxp文件拖拽进安装器，或者按快捷键`cmd + o`然后，选择zxp文件进行安装。如果之前安装过bodymovin，会覆盖掉原来的版本  
</br>  
<img src="https://aescripts.com/media/wysiwyg/aescripts/learn/ZXP_Installer_Drag_and_Drop_UI.png" width="50%"/>


## 关于导出的png黑边问题
bodymovin主要是用于导出矢量动画，当AE合成中有图片资源需要导出时，bodymovin使用了AE一个「内部函数」来生成png图片资源:
```
comp.saveFrameToPng()
```
这个是AE的内部函数（undocumented method），能快速的将当前页面的内容保存为png图片，但最大的问题是保存出来的png图片如果是带透明通道的，会在不透明像素的边缘生成「黑边」，如下图，右边带透明通道的就有「黑边」，左边没有透明部分就不受影响：  
### 正常png图片
<img src="https://raw.githubusercontent.com/bigxixi/ReadMe-Resources/master/SaveFrameAsPNG-Plus/goodalpha1.png" width="75%"/>

### bodymovin导出的png图片
<img src="https://raw.githubusercontent.com/bigxixi/ReadMe-Resources/master/SaveFrameAsPNG-Plus/badalpha1.png" width="75%"/>


这是什么情况？经过测试，感觉这个函数导出速度很快，我猜是因为它是直接从显存里获取图像的，而在GPU在处理资源时，为了效率会使用一种「预乘（Premultiplied）」技术，这个技术的特点是如果引擎不支持，呈现出来的png图片边缘会有「黑边」，感兴趣可以看下这篇文章： 
https://segmentfault.com/a/1190000002990030  
如果这导出的图片最后我们还是要导入AE，我们可以通过设置将图片的alpha模式设置为「预乘（Premultiplied）」，预乘颜色设置为黑色来解决。 

<img src="https://raw.githubusercontent.com/bigxixi/ReadMe-Resources/master/bodymovincn/prem.png" width="100%"/>

但是我们用bodymovin是为了导出给web或者安卓、ios使用，无法确定这些平台是否支持预乘技术，所以还是最好能直接导出传统png比较好。  
所以我写了一个函数不走saveFrameToPng()导出png图片，直接用AE的渲染队列（render queue）处理，用AE渲染引擎渲染出来的效果总该没问题了吧？然后替换了bodymovin里的saveFrameToPng()方法，目前为止用它做了一些项目还没发现什么问题（我在mac下使用，windows没有大量测试，理论上也不会有什么问题）。  
代码如下：  
https://gist.github.com/bigxixi/d65f46552f8d1c2b91a8638f018f1843   

我给bodymovin作者[提了这个方案](https://github.com/airbnb/lottie-web/issues/421)，不过他一直没能修复。。。所以就自己动手丰衣足食了XD  


## 关于汉化
主界面的汉化没什么技术含量，就是找出对应字符串然后替换。  
有些消息文本是通过jsx脚本处理然后传递给界面的，如果直接在脚本里替换为中问就会出现乱码，经过测试把中文从utf-8编码转换成ascii码可以解决。  
由于bodymovin更新频繁，这次花了点时间做了个mac下的「[汉化+修复脚本](https://github.com/bigxixi/bodymovin_cn/blob/master/%E6%B1%89%E5%8C%96%2B%E4%BF%AE%E5%A4%8D%2B%E6%89%93%E5%8C%85%E5%B7%A5%E5%85%B7(mac).zip)」，未来只要不是大改，我只需要微调脚本就能持续更新了^_^  

如果你感兴趣也可以尝试自己汉化打包，步骤：  
1. 下载bodymovin.zxp[英文原版](https://github.com/airbnb/lottie-web/blob/master/build/extension/bodymovin.zxp) 
2. 下载「[汉化+修复脚本](https://github.com/bigxixi/bodymovin_cn/blob/master/%E6%B1%89%E5%8C%96%2B%E4%BF%AE%E5%A4%8D%2B%E6%89%93%E5%8C%85%E5%B7%A5%E5%85%B7(mac).zip)」，随便解压到某个文件夹。
3. 解压后的文件夹里有个「汉化+修复+打包脚本.command」文件，直接运行会提示需要权限，这时需要先打开终端，输入：
```
chmod +x "汉化+修复+打包脚本.command文件位置"
```
这个文件位置可以直接把「汉化+修复+打包脚本.command」文件拖拽进终端里生成。
然后回车，就赋予它执行权限了。
4. 双击「汉化+修复+打包脚本.command」文件，会提示输入zxp脚本路径，这时还是老办法，把bodymovin.zxp文件拖拽进来，回车，就开始汉化了。

提醒一下哈，这个脚本没经过多少测试，就试了在自己机器上能用，图个轻松。

## Donation - 求打赏:
如果您觉得本插件好用，欢迎打赏，感谢您的支持！  

[<img src="https://raw.githubusercontent.com/bigxixi/bigxixi.github.io/master/donate/index.hyperesources/wechat.png" width="30%" height="30%">](http://bigxixi.com/donate/index.html)
[<img src="https://raw.githubusercontent.com/bigxixi/bigxixi.github.io/master/donate/index.hyperesources/alipay%402x.jpg" width="30%" height="30%">](http://bigxixi.com/donate/index.html)  

也欢迎使用 PayPal：  

[<img src="https://raw.githubusercontent.com/bigxixi/bigxixi.github.io/master/donate/index.hyperesources/paypal.png" width="30%" height="30%">](https://www.paypal.me/bigxixi/index.html)  
